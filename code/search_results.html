<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>검색 결과</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1>검색 결과</h1>
      <div id="result"></div>
    </header>

    <section class="search-results">
      <h2>검색어: <span id="search-query"></span></h2>
      <ul id="movie-list"></ul>
    </section>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const query = urlParams.get("query");

      if (query) {
        document.getElementById("result").textContent = `검색어: "${query}"`;
      } else {
        document.getElementById("result").textContent = "검색어를 입력해주세요";
      }

      const apiKey = "http://www.omdbapi.com/?apikey=[62fbabdb]&";
      async function fetchMovies() {
        try {
          const response = await fetch(
            "http://www.omdbapi.com/?apikey=[62fbabdb]&"
          );

          const filteredMovies = apiKey.filter((movie) =>
            movie.title
              .toLowerCase()
              .replace(/\s+/g, "")
              .includes(query.toLowerCase().replace(/\s+/g, ""))
          );

          const movieList = document.getElementById("movie-list");
          movieList.innerHTML = "";

          if (filteredMovies.length > 0) {
            filteredMovies.forEach((movie) => {
              const listItem = document.createElement("li");
              listItem.innerHTML = `
          <a href="movie_details.html?title=${encodeURIComponent(movie.title)}">
            <img src="${movie.image}" alt="${movie.title}">
            <h3>${movie.title}</h3>
            <p>${movie.description}</p>
          </a>
        `;
              movieList.appendChild(listItem);
            });
          } else {
            movieList.innerHTML = "<li>검색 결과가 없습니다.</li>";
          }
        } catch (error) {
          console.errsor("Error fetching movies:", error);
          document.getElementById("movie-list").innerHTML =
            "<b>데이터를 가져오는 데 실패했습니다.</b>";
        }
      }

      fetchMovies();

      const filteredMovies = apiKey.filter((movie) =>
        movie.title
          .toLowerCase()
          .replace(" ", "")
          .includes(query.toLowerCase().replace(" ", ""))
      );

      const movieList = document.getElementById("movie-list");

      if (filteredMovies.length > 0) {
        filteredMovies.forEach((movie) => {
          const listItem = document.createElement("li");
          listItem.innerHTML = `
          <a href="movie_details.html?title=${encodeURIComponent(movie.title)}">
            <img src="${movie.image}" alt="${movie.title}">
            <h3>${movie.title}</h3>
            <p>${movie.description}</p>
          </a>
        `;
          movieList.appendChild(listItem);
        });
      } else {
        movieList.innerHTML = "<li>검색 결과가 없습니다.</li>";
      }
    </script>
  </body>
</html>
